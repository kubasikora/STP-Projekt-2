\documentclass[a4paper,titlepage,11pt,floatssmall]{mwrep}
\usepackage[left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
\usepackage[OT1]{fontenc}
\usepackage{polski}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{mathrsfs}
\usepackage{rotating}
\usepackage{pgfplots}
\usetikzlibrary{pgfplots.groupplots}

\usepackage{siunitx}

\usepackage{float}
\definecolor{szary}{rgb}{0.95,0.95,0.95}
\sisetup{detect-weight,exponent-product=\cdot,output-decimal-marker={,},per-mode=symbol,binary-units=true,range-phrase={-},range-units=single}

\SendSettingsToPgf
\title{\bf Sprawozdanie z projektu nr 2\\ Zadanie nr 2.38  \vskip 0.1cm}
\author{Jakub Sikora \and nr albumu 283418}
\date{\today}
\pgfplotsset{compat=1.15}	
\begin{document}


\makeatletter
\renewcommand{\maketitle}{\begin{titlepage}
		\begin{center}{\LARGE {\bf
					Wydział Elektroniki i Technik Informacyjnych}}\\
			\vspace{0.4cm}
			{\LARGE {\bf Politechnika Warszawska}}\\
			\vspace{0.3cm}
		\end{center}
		\vspace{5cm}
		\begin{center}
			{\bf \LARGE Sterowanie procesami \vskip 0.1cm}
		\end{center}
		\vspace{1cm}
		\begin{center}
			{\bf \LARGE \@title}
		\end{center}
		\vspace{2cm}
		\begin{center}
			{\bf \Large \@author \par}
		\end{center}
		\vspace*{\stretch{6}}
		\begin{center}
			\bf{\large{Warszawa, \@date\vskip 0.1cm}}
		\end{center}
	\end{titlepage}
	}
\makeatother
\maketitle

\tableofcontents


% pierwsza sekcja
\chapter{Model procesu }
Rozważany w ramach projektu proces jest opisany następującą transmitancją:

\begin{equation*}
G(s) = \frac{K_0 e^{-T_0 s}}{(T_1 s + 1)(T_2 s + 1)}
\end{equation*} 
\medskip
gdzie $K_0 = 4,3$, $T_0 = 5$, $T_1 = 1,85$ i  $T_2 = 5,35$.\\
Proces ten jest stabilny asymptotycznie, ponieważ oba jego zera mają ujemną część rzeczywistą.

$$
\left[\begin{array}{c}
s_{01} \\
s_{02} \\
\end{array} \right]
= 
\left[\begin{array}{c}
-0,5405	\\
-0,1869 \\
\end{array} \right]
$$

Oprócz dużych stałych czasowych, obiekt ten zawiera człon opóźniający. Znacząco utrudnia to skuteczną regulację tym obiektem.

\chapter{Zadania projektowe}
\section{Transmitancja dyskretna}
Przed przystąpieniem do projektowania regulatorów, wyznaczyłem transmitancję dyskretną $G(z)$ badanego procesu. Zgodnie z poleceniem przyjąłem okres próbkowania $T_p = 0,5s$. Do wyznaczenia transmitancji dyskretnej posłużyłem się ekstrapolatorem zerowego rzędu według którego transmitancja dyskretna ma następującą postać:

\begin{equation*}
G(z) = \frac{z-1}{z} \mathcal{Z} \bigg\{ \mathcal{L}^{-1} \bigg\{ \frac{G(s)}{s} \bigg\} \bigg\}  
\end{equation*}

W matlabie istnieje polecenie \texttt{c2d} do wyznaczania transmitancji dyskretnej na podstawie transmitancji ciągłej. Polecenie to wykorzystałem w skrypcie o nazwie \texttt{zad1.m}. Za jego pomocą uzyskałem następującą transmitancję dyskretną:

\begin{equation*}
G(z) = z^{-10}\frac{0,04818z^{-1} + 0,04268z^{-2}}{1 - 1,674z^{-1} + 0,6951z^{-2}}
\end{equation*} 

Uzyskana transmitancja ma zera w $z_{01} = 0.9108$ i w $z_{02} = 0.7632$ co jest zgodne z oczekiwaniami. Obiekt opisany transmitancją dyskretną powinien być stabilny tak jak obiekt opisany transmitancją ciągłą. Wszystkie zera $G(z)$ znajdują się w kole jednostkowym, co świadczy o asymptotycznej stabilności procesu.

\begin{figure}[H]
\centering
\includegraphics[width = 0.8\textwidth]{../figures/zad1_cont_disc_comp.pdf}
\caption{Odpowiedzi skokowe transmitancji dyskretnej i ciągłej}
\end{figure}

\newpage

Współczynnik wzmocnienia statycznego transmitancji ciągłej można uzyskać obliczając granicę:
\begin{equation*}
K_{stat_{c}} = \lim_{s\to 0} G(s) 
\end{equation*} 

Analogicznie, współczynnik wzmocnienia statycznego transmitancji dyskretnej uzyskujemy obliczając granicę:
\begin{equation*}
K_{stat_{d}} = \lim_{z\to 1} G(z)
\end{equation*}

Korzystając z otrzymanej transmitancji ciągłej otrzymałem $K_{stat_{c}} = 4.3$, natomiast korzystając z transmitancji dyskretnej obliczonej z matlaba również otrzymałem $K_{stat_{d}} = 4,3$. Wzmocnienia te są toższame z dokładnością do błędów numerycznych. Tożsamość dwóch współczynników była oczekiwana i tylko potwierdza zgodność obu opisów jednego procesu dynamicznego.

\section{Równanie różnicowe}
Znając transmitancję dyskretną, z łatwością można wyznaczyć równanie różnicowe opisujące obiekt postaci:

\begin{equation*}
y[k] = \sum_{i=1}^{n}b_{i}y[k - i] + \sum_{i=1}^{m}c_{i}u[k - i]
\end{equation*}

Odwołując się do definicji transmitancji:
\begin{equation*}
G(z) = \frac{Y(z)}{U(z)} = z^{-10}\frac{0,04818z^{-1} + 0,04268z^{-2}}{1 - 1,674z^{-1} + 0,6951z^{-2}}
\end{equation*}

Mnożąc wyrażenie na krzyż otrzymałem:
\begin{equation*}
z^{-10}(0,04818z^{-1} + 0,04268z^{-2})U(z) =  (1 - 1,674z^{-1} + 0,6951z^{-2})Y(z)
\end{equation*}

Dalej:
\begin{equation*}
0,04818z^{-11}U(z) + 0,04268z^{-12}U(z) = Y(z) - 1,674z^{-1}Y(z) + 0,6951z^{-2}Y(z)
\end{equation*}

Następnym krokiem jest zastosowanie odwrotnej transformaty $\mathcal{Z}$:
\begin{equation*}
0,04818u[k-11] + 0,04268u[k-12] = y[k] - 1,674y[k-1] + 0,6951y[k-2]
\end{equation*}

Ostatecznie po uporządkowaniu wyrazów otrzymałem następujące równanie różnicowe:
\begin{equation*}
y[k] = 1,674y[k-1] - 0,6951y[k-2] + 0,04818u[k-11] + 0,04268u[k-12]  
\end{equation*}

\newpage

\section{Regulator PID}
W ramach następnego zadania wykonałem eksperyment Zieglera-Nicholsa w celu doboru odpowiednich nastawów regulatora PID. Eksperyment ten polega na znalezieniu takiego wzmocnienia regulatora P, który sprawi że obiekt przez niego sterowany znajdzie się na granicy stabilności. Wzmocnienie to nazywamy \emph{wzmocnieniem krytycznym}. Odpowiedzią obiektu znajdującego się na granicy stabilności na skok jednostkowy są niegasnące oscylacje. Poszukiwanym przez nas parametrem jest okres tych oscylacji. Znając okres oscylacji i wzmocnienie krytyczne, można wyznaczyć nastawy regulatora PID korzystając z tabelki.
\medskip
\begin{center}
\begin{tabular}{|c|c|c|c|} \hline
Regulator & $K$ & $T_i$ & $T_d$ \\
\hline \hline
P & $0,5K_u$ & - & -\\
\hline
PI & $0,45K_u$ & $0,83T_u$ & - \\
\hline
PID & $0,6K_u$ & $0,5T_u$ & $0,12T_u$ \\
\hline 
\end{tabular}\\
Tabela 2.1 Nastawy regulatorów P, PI, PID.
\end{center}
\bigskip
Eksperyment Z-N wykonałem za pomocą skryptu \texttt{/scripts/zad3\_{}zn.m}. 
Wzmocnienie krytyczne wyznaczałem iteracyjnie. Jeśli na skok jednostkowy, proces odpowiadał gasnącymi oscylacjami, oznaczało to że aktualne wzmocnienie jest za małe. Na rysunku poniżej znajduje się odpowiedź obiektu z regulatorem typu P z wzmocnieniem $K_p = 0,4$.

\begin{figure}[H]
\centering
\includegraphics[width = 0.80\textwidth]{../figures/zad3_zn_exp_too_small.pdf}
\caption{Za małe wzmocnienie regulatora P - gasnące oscylacje}
\end{figure}

\newpage
Przy zwiększaniu wzmocnienia, istniało ryzyko że możemy przekroczyć granicę stabilności. Objawiało się to rosnącymi oscylacjami.

\begin{figure}[H]
\centering
\includegraphics[width = 0.80\textwidth]{../figures/zad3_zn_exp_too_big.pdf}
\caption{Za duże wzmocnienie regulatora P - rosnące oscylacje}
\end{figure}

Ostatecznie udało mi się dobrać odpowiednie wzmocnienie krytyczne które równe jest $K_u = 0,5125$.

\begin{figure}[H]
\centering
\includegraphics[width = 0.80\textwidth]{../figures/zad3_zn_exp.pdf}
\caption{Wzmocnienie krytyczne - obiekt na granicy stabilności}
\end{figure}

\newpage

Okres oscylacji przebiegu z rysunku 2.4 wynosi 41 próbek. Okres ten znalazłem odczytując ile próbek dzieli poszczególne wierzchołki sinusoidy i mnożąc tą ilość przez czas próbkowania. Ostatecznie $T_u = 20,5s$.

Znając wyniki eksperymentu Zieglera-Nicholsa można w prosty sposób obliczyć nastawy regulatora. Podstawiając do wzorów z tabeli 2.1, uzyskałem:

\begin{center}
	$K_p = 0,3075$ \\
	
	$T_i = 10,25$ \\

	$T_d = 2,46$ \\
\end{center}

Uzyskane nastawy dotyczą ciągłego układu regulacji opisanego wzorem:
\begin{equation*}
u(t) = K_p\bigg(e(t) + \int_{0}^{t}e(\tau)d\tau + \frac{de(t)}{dt}\bigg)
\end{equation*}

Dyskretny układ regulacji PID opisany jest wzorem:
\begin{equation*}
u[k] = u[k-1] + r_1e[k] + r_2e[k-1] + r_3e[k-2]
\end{equation*}

Relację łączącą układ ciągły i dyskretny wyznaczają wzory:
\begin{center}
	$r_1 = K_p\bigg(1 + \frac{T_p}{2T_i} + \frac{T_d}{T_p}\bigg)$ \\
	
	$r_2 = K_p\bigg(\frac{T_p}{2T_i} - \frac{2T_d}{T_p} - 1 \bigg)$\\

	$r_3 = K_p\frac{T_d}{T_p}$ \\
\end{center}

Po podstawieniu do wzorów otrzymałem:
\begin{center}
	$r_1 = 1,8279$ \\
	
	$r_2 = -3,3258$ \\

	$r_3 = 1,5129$ \\
\end{center}

Po uzyskaniu nastawów, przetestowałem ten regulator badając jak zachowa się układ regulacji po pobudzeniu go skokiem jednostkowym.

\begin{figure}[H]
\centering
\includegraphics[width = 0.80\textwidth]{../figures/zad4_pid_zn.pdf}
\caption{Odpowiedź układu z regulatorem uzyskanym za pomocą eksperymentu Z-N}
\end{figure}

\bigskip

Jak widać na rysunku 2.5, w układzie regulacji występują duże oscylacje, dodatkowo występuje bardzo duże przeregulowanie wielkości 70 \% skoku sterowania. Dzieje się tak ponieważ regulatory uzyskane za pomocą tej metody mają tendencję do generowania przebiegów oscylacyjnych. Ważnym elementem dobierania regulatora metodą Zieglera-Nicholsa jest ręczne strojenie nastawów.

Ręcznie dostrojone nastawy regulatora PID:

\begin{center}
	$K_p = 0,19$ \\
	$T_i = 8,4$ \\
	$T_d = 2,13$ \\
\end{center}

W użytecznej wersji dyskretnej:

\begin{center}
	$r_1 = 1,0051$ \\  
	$r_2 = -1,8031$ \\ 
	$r_3 = 0,8094$ \\
\end{center}

\begin{figure}[H]
\centering
\includegraphics[width = 0.90\textwidth]{../figures/zad4_pid_zn_popr.pdf}
\caption{Odpowiedź układu z ręczniem dostrojonym regulatorem}
\end{figure}
\newpage 
Regulator ten bardzo dobrze reaguje na zmiany wartości zadanej. Charakteryzuje się jednak gwałtownymi zmianami sterowania.
\begin{figure}[H]
\centering
\includegraphics[width = 0.90\textwidth]{../figures/zad4_pid_zn_popr_zmienne_y_zad.pdf}
\caption{Odpowiedź układu z ręczniem dostrojonym regulatorem na zmienną wartość zadaną.}
\end{figure}

\section{Regulator DMC}
Drugi rozważany regulator implementuje cyfrowy algorytm regulacji DMC w wersji analitycznej bez ograniczeń. Algorytm ten cechuje się tym że w procesie generacji sterowania, posługuje się modelem obiektu w postaci dyskretnych odpowiedzi skokowych postaci $\{s_1, s_2, s_3, ...\}$. Algorytm DMC jest algorytmem predykcyjnym a więc w każdej iteracji rozwiązywany jest problem optymalizacji błędu wyjścia.

\begin{center}

$\min_{\Delta u} = \bigg( \sum_{i=1}^{N}(y_{k+i|k}^{zad} - y_{k+i|k})^2 + \sum_{i=0}^{N_{u} - 1}\lambda(\Delta u_{k+i|k})^2 \bigg)$

\end{center}

W regulatorze DMC przewidywany jest wektor optymalnych sterowań na $N_u$ chwil w przód. Wartość $N_u$ nazywana jest horyzontem sterowania. Wektor ten obliczany jest na podstawie wartości zadanej, aktualnej wartości wyjścia procesu i zmianach sterowania w ostatnich $D-1$ chwilach dyskretnych. Wartość $D$ nazywana jest horyzontem dynamiki. Jego wartość mówi ile próbek dyskretnych musi minąć aby ustaliła się odpowiedź skokowa sterowanego obiektu działającego poza układem regulacji. Wartość wyjść jest przewidywana na $N$ chwil w przód. Wartość $N$ nazywana jest horyzontem predykcji i mówi o tym na ile chwil w przód przewidywane jest wyjście procesu a co za tym idzie ile próbek jest branych do zadania minimalizacji.\\
\newpage

Znając model procesu można z łatwością wyznaczyć prawo regulacji. Zanim jednak to nastąpi należy wyznaczyć dwie macierze związane z modelem. Pierwsza z nich to macierz skróconych odpowiedzi skokowych:

$$
\mathbf{M} =
\left[ \begin{array}{ccccc}
s_1 & 0 & \cdots & 0 & 0\\
s_2 & s_1 & \cdots & 0 & 0\\
\vdots & \vdots & \ddots & \vdots & \vdots  \\
s_N & s_{N-1} & \cdots & s_{N - N_u + 2}& s_{N - N_u + 1}\\
\end{array} \right]
$$

Drugą macierzą związaną z modelem jest macierz predykcji opisana wzorem:

$$
\mathbf{M^{P}} =
\left[ \begin{array}{cccc}
s_2 - s_1 & s_3 - s_2 & \cdots & s_D - s_{D-1}  \\
s_3 - s_1 & s_4 - s_2 & \cdots & s_{D+1} - s_{D-1} \\
\vdots & \vdots & \ddots &  \vdots \\
s_{N+1} - s_1 & s_{N+2} - s_2 & \cdots & s_{N + D - 1} - s_{D-1}\\
\end{array} \right]
$$

Na podstawie macierzy odpowiedzi skokowych należy wyznaczyć macierz $\mathbf{K}$:

$$
\mathbf{K} =
\left[ \begin{array}{cccc}
k_{1,1} & k_{1,2} & \cdots & k_{1,N} \\
s_{2,1} & s_{2,2} & \cdots & k_{2,N} \\
\vdots & \vdots & \ddots & \vdots  \\
k_{N_u,1} & k_{N_u,2} & \cdots & k_{N_u,N}\\
\end{array} \right]
$$

Analityczne prawo regulacji DMC ma postać:

\begin{equation*}
\Delta u_{k|k} = k^{e}(y_k^{zad} - y_k) -\sum_{j=1}^{D-1} k_j^u \Delta u_{k-j},
\end{equation*}
\begin{center}
gdzie $k^{e} = \sum_{j=1}^{N} k_{1,j} $ i $
K_{1}M^{P} =
\left[ \begin{array}{cccc}
k_{1}^u & k_{2}^u & \cdots & k_{D-1}^u \\
\end{array} \right]
$
\end{center}

\bigskip
Cały algorytm regulacji DMC został zaimplementowany w skrypcie \texttt{/scripts/zad4\_{}dmc.m}. Do wyznaczania odpowiedzi skokowej zostało wykorzystane równanie róznicowe, badane w sekcji \texttt{Równanie różnicowe}.


\begin{figure}[H]
\centering
\includegraphics[width = 0.70\textwidth]{../figures/zad4_dmc_l_1_N_80_Nu_80_D_80.pdf}
\caption{Przykładowa odpowiedź regulatora DMC z parametrami $N = 80$, $N_u = 80$, $\lambda = 1$}
\end{figure}


\section{Badanie parametrów regulatora DMC}



\end{document}
